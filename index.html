<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SophosWRLD</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Inter Font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <style>
        :root {
            --accent-color: #ef4444; /* Default red accent */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* dark:bg-gray-900 */
        }
        
        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* dark:bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }
        
        /* Left Sidebar Collapsed by default on desktop, hidden on mobile */
        .left-sidebar {
            width: 72px;
            transition: width 0.3s ease-in-out;
            z-index: 50;
            background-color: #1f2937; /* dark:bg-gray-800 */
        }

        .left-sidebar.expanded {
            width: 256px;
        }

        /* Mobile sidebar */
        @media (max-width: 768px) {
            .left-sidebar {
                position: fixed;
                top: 0;
                left: -256px;
                height: 100%;
                width: 256px;
                transition: left 0.3s ease-in-out;
            }
            .left-sidebar.expanded {
                left: 0;
            }
        }

        .left-sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
            padding: 0 1rem;
            color: white;
            border-bottom: 1px solid #374151; /* dark:border-gray-700 */
        }

        .left-sidebar.expanded .left-sidebar-header {
            justify-content: flex-start;
        }

        .sidebar-logo-text {
            font-weight: 700;
            font-size: 1.5rem;
            display: none;
        }

        .left-sidebar.expanded .sidebar-logo-text {
            display: block;
            margin-left: 0.5rem;
        }

        .sidebar-nav-item {
            display: flex;
            align-items: center;
            height: 48px;
            padding: 0 1rem;
            color: #d1d5db; /* dark:text-gray-400 */
            border-radius: 0.5rem;
            margin: 0.5rem 0;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
        }
        
        .sidebar-nav-item:hover {
            background-color: #374151; /* dark:bg-gray-700 */
            color: white;
        }

        .sidebar-nav-item.active {
            background-color: #4b5563; /* dark:bg-gray-600 */
            color: white;
        }

        .sidebar-nav-item-icon {
            font-size: 1.25rem;
            min-width: 40px;
        }

        .sidebar-nav-item-text {
            display: none;
        }

        .left-sidebar.expanded .sidebar-nav-item-text {
            display: block;
            margin-left: 0.5rem;
        }
        
        .main-content {
            flex-grow: 1;
            padding: 1.5rem;
            color: white;
            overflow-y: auto;
        }
        
        .overlay-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 40;
            display: none;
        }

        .overlay-backdrop.active {
            display: block;
        }

        .message-box-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .message-box-content {
            background-color: #1f2937;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            max-width: 400px;
            width: 100%;
            text-align: center;
        }
        
        .message-box-text {
            margin-bottom: 1rem;
            color: white;
        }
        
        .message-box-button {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            background-color: var(--accent-color);
            color: white;
            font-weight: 500;
            cursor: pointer;
        }
    </style>
</head>
<body class="flex flex-col md:flex-row h-screen overflow-hidden">

    <!-- Mobile Header -->
    <div class="md:hidden flex items-center justify-between p-4 bg-gray-800 text-white">
        <div class="flex items-center">
            <span class="text-xl font-bold text-red-500">SophosWRLD</span>
        </div>
        <div class="flex items-center space-x-4">
            <button id="mobile-auth-btn" class="px-3 py-1 bg-red-600 text-white rounded-lg text-sm font-semibold hover:bg-red-700 transition">
                Sign In
            </button>
            <button id="mobile-menu-toggle" class="text-white focus:outline-none">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <!-- Left Sidebar -->
    <aside id="left-sidebar" class="left-sidebar flex flex-col items-center md:items-start p-2 md:h-screen md:sticky md:top-0">
        <div class="left-sidebar-header hidden md:flex">
            <button id="sidebar-toggle" class="text-white focus:outline-none">
                <i class="fas fa-bars"></i>
            </button>
            <div class="flex items-center">
                <span class="sidebar-logo-text text-red-500">SophosWRLD</span>
            </div>
        </div>

        <nav id="sidebar-nav-container" class="mt-4 w-full flex-grow overflow-y-auto">
            <!-- Sidebar Navigation items will be rendered here dynamically -->
        </nav>
    </aside>

    <!-- Overlay Backdrop for Mobile Sidebar -->
    <div id="overlay-backdrop" class="overlay-backdrop hidden"></div>

    <!-- Main Content Area -->
    <main id="main-content" class="main-content overflow-y-auto"></main>
    
    <!-- Custom Message Box HTML -->
    <div id="message-box-overlay" class="message-box-overlay hidden">
        <div class="message-box-content">
            <p id="message-box-text" class="message-box-text"></p>
            <button id="message-box-button" class="message-box-button">OK</button>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCbdfLVFXpRg-wTev7QfPhyJ-LFPpyI3mU",
            authDomain: "sophoswrld.firebaseapp.com",
            databaseURL: "https://sophoswrld-default-rtdb.firebaseio.com",
            projectId: "sophoswrld",
            storageBucket: "sophoswrld.firebasestorage.app",
            messagingSenderId: "26686142400",
            appId: "1:26686142400:web:48f8d3ae0b097731317a25",
            measurementId: "G-6XETC98C22"
        };
        
        // Global variables for Firebase
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Global state variables
        let appCurrentUser = null;
        let appUserData = null;
        let userId = null;

        // Custom Message Box function
        function showMessageBox(message) {
            const overlay = document.getElementById('message-box-overlay');
            const textElement = document.getElementById('message-box-text');
            const buttonElement = document.getElementById('message-box-button');

            textElement.textContent = message;
            overlay.classList.remove('hidden');

            const hideMessageBox = () => {
                overlay.classList.add('hidden');
                buttonElement.removeEventListener('click', hideMessageBox);
            };

            buttonElement.addEventListener('click', hideMessageBox);
        }

        // DOM elements
        const leftSidebar = document.getElementById('left-sidebar');
        const overlayBackdrop = document.getElementById('overlay-backdrop');
        const mainContent = document.getElementById('main-content');
        const sidebarNavContainer = document.getElementById('sidebar-nav-container');

        // Navigation state
        let currentPage = 'home';

        // Sidebar content
        const navItems = [
            { id: 'home', icon: 'fas fa-home', text: 'Home' },
            { id: 'dashboard', icon: 'fas fa-chart-line', text: 'Dashboard' },
            { id: 'profile', icon: 'fas fa-user', text: 'Profile' },
            { id: 'store', icon: 'fas fa-store', text: 'Store' },
            { id: 'wrld-shop', icon: 'fas fa-shopping-bag', text: 'WRLD-SHOP' },
            { id: 'settings', icon: 'fas fa-cog', text: 'Settings' },
            { id: 'logout', icon: 'fas fa-sign-out-alt', text: 'Sign Out' },
        ];

        const renderSidebarNav = (user) => {
            sidebarNavContainer.innerHTML = '';
            
            // Filter nav items based on authentication status
            let itemsToRender = user ? navItems : navItems.filter(item => item.id !== 'logout');

            // Add Sign In button if user is not authenticated
            if (!user) {
                itemsToRender.push({ id: 'auth', icon: 'fas fa-sign-in-alt', text: 'Sign In' });
            }

            itemsToRender.forEach(item => {
                const navElement = document.createElement('div');
                navElement.id = `nav-${item.id}`;
                navElement.className = `sidebar-nav-item group ${currentPage === item.id ? 'active' : ''}`;
                navElement.dataset.page = item.id;
                navElement.innerHTML = `
                    <i class="${item.icon} sidebar-nav-item-icon"></i>
                    <span class="sidebar-nav-item-text">${item.text}</span>
                `;
                navElement.addEventListener('click', () => navigateTo(item.id));
                sidebarNavContainer.appendChild(navElement);
            });
        };

        const navigateTo = (page) => {
            if (page === 'logout') {
                signOut(auth).catch(error => {
                    console.error("Error signing out:", error);
                });
                return;
            }

            // Check if user is authenticated before navigating to protected pages
            if (!appCurrentUser && page !== 'auth') {
                showMessageBox('You must be signed in to view this page.');
                navigateTo('auth');
                return;
            }

            currentPage = page;
            localStorage.setItem('currentPage', page);
            updateActiveNav();
            renderPage(page);

            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 768) {
                leftSidebar.classList.remove('expanded');
                overlayBackdrop.classList.add('hidden');
            }
        };

        const updateActiveNav = () => {
            document.querySelectorAll('.sidebar-nav-item').forEach(item => {
                if (item.dataset.page === currentPage) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        };

        const renderPage = (page) => {
            let pageContent = '';
            switch (page) {
                case 'home':
                    pageContent = `<h1 class="text-3xl font-bold mb-4">Welcome to SophosWRLD!</h1>
                                  <p>Explore the features and manage your projects from the sidebar.</p>`;
                    break;
                case 'dashboard':
                    pageContent = `<h1 class="text-3xl font-bold mb-4">Dashboard</h1>
                                  <p>This is your personalized dashboard.</p>`;
                    break;
                case 'profile':
                    pageContent = `<h1 class="text-3xl font-bold mb-4">User Profile</h1>
                                  <p>User ID: <span id="user-id">${userId}</span></p>
                                  <p>This is where your profile information will be displayed.</p>`;
                    break;
                case 'store':
                    pageContent = `<h1 class="text-3xl font-bold mb-4">Store</h1>
                                  <p>Welcome to the store! Browse and purchase items here.</p>`;
                    break;
                case 'wrld-shop':
                    pageContent = `<h1 class="text-3xl font-bold mb-4">WRLD-SHOP</h1>
                                  <p>This is the special WRLD-SHOP with unique items.</p>`;
                    break;
                case 'settings':
                    pageContent = `<h1 class="text-3xl font-bold mb-4">Settings</h1>
                                  <p>Manage your account settings here.</p>`;
                    break;
                case 'auth':
                    pageContent = `<div class="flex flex-col items-center justify-center h-full">
                                      <h1 class="text-4xl font-extrabold text-red-500 mb-6">SophosWRLD</h1>
                                      <div class="bg-gray-800 p-8 rounded-xl shadow-lg w-full max-w-md">
                                          <h2 class="text-2xl font-bold text-center text-white mb-6">Sign In / Sign Up</h2>
                                          <p class="text-center text-gray-400 mb-8">Please sign in to continue.</p>
                                          <button id="auth-sign-in" class="w-full py-3 px-4 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 transition duration-300 ease-in-out transform hover:scale-105">
                                              Sign In
                                          </button>
                                      </div>
                                  </div>`;
                    break;
                default:
                    pageContent = `<h1 class="text-3xl font-bold">404 - Page Not Found</h1>`;
                    break;
            }
            mainContent.innerHTML = pageContent;
            
            // Add a placeholder event listener for the sign-in button
            if (page === 'auth') {
                 document.getElementById('auth-sign-in').addEventListener('click', () => {
                     showMessageBox("Sign in functionality is not yet implemented. Please implement an authentication method to continue.");
                 });
            }
        };

        const initializeNavigation = () => {
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');

            sidebarToggle.addEventListener('click', () => {
                leftSidebar.classList.toggle('expanded');
            });

            mobileMenuToggle.addEventListener('click', () => {
                leftSidebar.classList.toggle('expanded');
                overlayBackdrop.classList.toggle('hidden');
            });

            overlayBackdrop.addEventListener('click', () => {
                leftSidebar.classList.remove('expanded');
                overlayBackdrop.classList.add('hidden');
            });
        };
        
        // This is a Firestore function to get or create user data. It's an example for future use.
        const getUserData = async (uid) => {
            const userDocRef = doc(db, `artifacts/${appId}/users/${uid}/userData`, 'profile');
            const userDocSnap = await getDoc(userDocRef);

            if (userDocSnap.exists()) {
                return userDocSnap.data();
            } else {
                const newUserData = {
                    createdAt: new Date().toISOString(),
                    userId: uid,
                    // Add other default user data here
                };
                await setDoc(userDocRef, newUserData);
                return newUserData;
            }
        };

        // Firebase Auth State Listener
        onAuthStateChanged(auth, async (user) => {
            appCurrentUser = user;
            if (user) {
                userId = user.uid;
                appUserData = await getUserData(user.uid);
                renderSidebarNav(appCurrentUser);
                
                const currentPageFromStorage = localStorage.getItem('currentPage');
                if (currentPageFromStorage && currentPageFromStorage !== 'auth') {
                    navigateTo(currentPageFromStorage);
                } else {
                    navigateTo('home');
                }
            } else {
                appUserData = null;
                userId = null;
                renderSidebarNav(appCurrentUser);
                navigateTo('auth');
            }
        });

        document.addEventListener('DOMContentLoaded', async () => {
            initializeNavigation();
            const mobileAuthButton = document.getElementById('mobile-auth-btn');
            if(mobileAuthButton) {
                mobileAuthButton.addEventListener('click', () => {
                    navigateTo('auth');
                    if (window.innerWidth <= 768) {
                        leftSidebar.classList.remove('expanded');
                        overlayBackdrop.classList.add('hidden');
                    }
                });
            }
            
            // Use the initial auth token for sign in if it exists
            if (initialAuthToken) {
                try {
                     await signInWithCustomToken(auth, initialAuthToken);
                } catch (error) {
                     console.error("Error signing in with custom token:", error);
                     navigateTo('auth');
                }
            }
        });
    </script>
</body>
</html>
